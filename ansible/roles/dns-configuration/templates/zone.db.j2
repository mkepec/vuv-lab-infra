; DNS Zone File for {{ item.zone.name }}
; Generated by Ansible on {{ ansible_date_time.iso8601 }}
; DO NOT EDIT MANUALLY - This file is managed by dns-configuration role

$TTL    {{ item.zone.ttl | default(86400) }}
@       IN      SOA     {{ item.zone.primary_ns | default('dns-bind.' + item.zone.name + '.') }}. {{ item.zone.admin_email | default('admin.' + item.zone.name + '.') }}. (
                        {{ item.zone.serial | default(ansible_date_time.epoch) }}  ; Serial
                        {{ item.zone.refresh | default(3600) }}                    ; Refresh
                        {{ item.zone.retry | default(1800) }}                      ; Retry
                        {{ item.zone.expire | default(604800) }}                   ; Expire
                        {{ item.zone.minimum | default(86400) }} )                 ; Minimum TTL

; Name servers
@       IN      NS      {{ item.zone.primary_ns | default('dns-bind.' + item.zone.name + '.') }}.

{% for record in item.records %}
{% if record.type == 'A' %}
{{ "%-20s" | format(record.name) }} IN      A       {{ record.value }}
{% elif record.type == 'AAAA' %}
{{ "%-20s" | format(record.name) }} IN      AAAA    {{ record.value }}
{% elif record.type == 'CNAME' %}
{{ "%-20s" | format(record.name) }} IN      CNAME   {{ record.value }}{% if not record.value.endswith('.') %}.{{ item.zone.name }}.{% endif %}
{% elif record.type == 'MX' %}
{{ "%-20s" | format(record.name) }} IN      MX      {{ record.priority | default(10) }} {{ record.value }}{% if not record.value.endswith('.') %}.{{ item.zone.name }}.{% endif %}
{% elif record.type == 'TXT' %}
{{ "%-20s" | format(record.name) }} IN      TXT     "{{ record.value }}"
{% elif record.type == 'SRV' %}
{{ "%-20s" | format(record.name) }} IN      SRV     {{ record.priority | default(10) }} {{ record.weight | default(0) }} {{ record.port }} {{ record.value }}{% if not record.value.endswith('.') %}.{{ item.zone.name }}.{% endif %}
{% elif record.type == 'NS' %}
{{ "%-20s" | format(record.name) }} IN      NS      {{ record.value }}{% if not record.value.endswith('.') %}.{{ item.zone.name }}.{% endif %}
{% endif %}
{% endfor %}

; Additional records can be added via dns-config data files