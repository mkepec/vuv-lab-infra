// BIND9 Options Configuration
// Generated by Ansible - DO NOT EDIT MANUALLY

acl "trusted-networks" {
{% for network in bind_allow_query %}
    {{ network }};
{% endfor %}
};

options {
    directory "/var/cache/bind";

    // DNS Security
    dnssec-validation auto;
    auth-nxdomain no;    # conform to RFC1035
    
    // Listening interfaces
{% if bind_listen_ipv4 != "any" %}
    listen-on port 53 { {{ bind_listen_ipv4 }}; 127.0.0.1; };
{% else %}
    listen-on port 53 { any; };
{% endif %}
{% if bind_listen_ipv6 != "none" %}
    listen-on-v6 port 53 { {{ bind_listen_ipv6 }}; ::1; };
{% else %}
    listen-on-v6 { none; };
{% endif %}

    // Query permissions
    allow-query { trusted-networks; };
    allow-recursion { trusted-networks; };
    
    // Forwarding configuration
    recursion yes;
{% if bind_forwarders %}
    forwarders {
{% for forwarder in bind_forwarders %}
        {{ forwarder }};
{% endfor %}
    };
    forward {{ bind_forward_policy }};
{% endif %}

    // Performance tuning
    max-cache-size 256m;
    cleaning-interval 60;
    
    // Security settings
    allow-transfer { none; };
    allow-update { none; };
    version none;
    hostname none;
    server-id none;
    
    // Rate limiting
    rate-limit {
        responses-per-second 10;
        window 5;
    };
};